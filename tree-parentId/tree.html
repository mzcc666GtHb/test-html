<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script>
var treejson = [{"id":"1", "pid":"", "name":"node1", "node":""},
  {"id":"2", "pid":"1", "name":"node2", "node":""},
  {"id":"3", "pid":"1", "name":"node3", "node":""},
  {"id":"4", "pid":"1", "name":"node4", "node":""},
  {"id":"5", "pid":"2", "name":"node5", "node":""},
  {"id":"6", "pid":"2", "name":"node6", "node":""},
  {"id":"7", "pid":"2", "name":"node7", "node":""},
  {"id":"8", "pid":"7", "name":"node8", "node":""},
  {"id":"9", "pid":"7", "name":"node9", "node":""},
  {"id":"10", "pid":"7", "name":"node10", "node":""},
  {"id":"11", "pid":"10", "name":"node11", "node":""},
  {"id":"12", "pid":"10", "name":"node12", "node":""},
  {"id":"13", "pid":"10", "name":"node13", "node":""},
  {"id":"14", "pid":"1", "name":"node14", "node":""},
  {"id":"15", "pid":"2", "name":"node15", "node":""},
  {"id":"16", "pid":"10", "name":"node16", "node":""}];



//格式化数据，建立多叉树
function formatTreeData(treejson)
{
  if(!treejson)return;
  var formatTreeJson = {};
  for(var i = 0; i < treejson.length; i++)
  {
    if(formatTreeJson[treejson[i].pid])
    {
      var x = formatTreeJson[treejson[i].pid].i * 1 + 1;
      formatTreeJson[treejson[i].pid].i = x;

      //node数以三位递增，不足补0
      treejson[i].node = x*1 < 10 ? ("00" + x):( x*1 > 100 ? x : ("0" + x));
      formatTreeJson[treejson[i].pid].child.push(treejson[i]);
    }
    else
    {
      formatTreeJson[treejson[i].pid] = {};
      formatTreeJson[treejson[i].pid].i = 1;
      formatTreeJson[treejson[i].pid].child = [];
      treejson[i].node = "001";
      formatTreeJson[treejson[i].pid].child.push(treejson[i]);
    }
  }
  return formatTreeJson;
}


var formatJson = null;
function generateNode()
{
  formatJson = formatTreeData(treejson);
  var nodeArr = [];
  node(formatJson[""], "", nodeArr);

  // 其中nodeArr就是生产后的数据
  console.log(JSON.stringify(nodeArr));
}

function node(json, pnode, arr)
{
  if(!json) return;

  for(var i = 0, len = json.child.length; i < len; i++)
  {
    json.child[i].node = pnode + json.child[i].node;
    arr.push(json.child[i]);
    node(formatJson[json.child[i].id], json.child[i].node, arr);
  }
}

console.log(formatTreeData())
</script>
</body>
</html>
